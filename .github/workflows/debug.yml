name: Debug AWX Token

on:
  workflow_dispatch: # Allows you to run this manually

jobs:
  test-token-and-resolution:
    runs-on: self-hosted # CRITICAL: Must run on your runner
    
    steps:
      - name: Test AWX Token
        # We pass the GitHub variables/secrets into the step's environment
        env:
          HOST_TO_TEST: ${{ vars.AWX_HOST }}
          ID_TO_TEST: ${{ vars.AWX_JOB_TEMPLATE_ID }}
          # This securely injects your secret into the step
          TEST_TOKEN: ${{ secrets.AWX_TOKEN }} 
        run: |
          echo "--- DEBUGGING GITHUB ACTIONS VARIABLES ---"
          echo "Value of 'vars.AWX_HOST': [$HOST_TO_TEST]"
          echo "Value of 'vars.AWX_JOB_TEMPLATE_ID': [$ID_TO_TEST]"
          echo "----------------------------------------------"
          
          if [ -z "$HOST_TO_TEST" ]; then
            echo "Error: 'AWX_HOST' repository variable is EMPTY."
            echo "Please go to Repository Settings > Secrets and variables > Actions > Variables and set 'AWX_HOST'."
            exit 1
          fi

          if [ -z "$TEST_TOKEN" ]; then
            echo "Error: 'AWX_TOKEN' repository secret is EMPTY."
            echo "Please go to Repository Settings > Secrets and variables > Actions > Secrets and set 'AWX_TOKEN'."
            exit 1
          fi
          
          echo ""
          echo "Success: Variables and Secret are loaded."
          echo "Attempting to authenticate to AWX at: http://$HOST_TO_TEST"
          echo ""
          
          # This is the test. It uses the secret.
          # We use curl -i to show headers, and -sS to hide progress but show errors.
          # This command attempts to list your job templates.
          curl -i -sS -H "Authorization: Bearer $
